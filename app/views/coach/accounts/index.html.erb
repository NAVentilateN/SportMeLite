<div class='container'>
  <div class='flex-space-between'>
    <h1 class='accounts-header'>Accounts</h1>
  </div>
</div>
  <div class='charts-container'>
    <div class='accounts-chart'>
      <% Groupdate.time_zone = "Asia/Singapore" %>
      <h3>Bookings per Day</h3>
      <%= column_chart @data.group_by_day { |order| order.created_at }.map { |date, orders| [date.strftime("%d %b"), orders.count] }.to_h, width: "500px", height: "300px", colors: ["#ff3d00", "#ff5d03"] %>
    </div>
    <div class='accounts-chart'>
      <h3>Revenue per Day</h3>
      <%= line_chart  @data.group_by_day { |order| order.created_at }.map { |date, orders| [date.strftime("%d %b"), orders.map { |order| order.amount_cents }.sum.to_f / 100] }.to_h, discrete: true, width: "500px", height: "300px", colors: ["#ff3d00", "#ff5d03"], prefix: "$" %>
    </div>
  </div>
<div class='container'>
  <div class='accounts-container'>
    <% date = "" %>
    <% @lessons_with_orders.reverse.each do |lesson| %>
      <% if lesson.order.created_at.localtime.strftime("%d %b %Y") != date %>
        <div class='accounts-date-card'> <%= lesson.order.created_at.localtime.strftime("%d %b %Y") %></div>
        <div class='accounts-card'>
          <div class='account-details'>
            <span><strong>Booked by: <%= lesson.order.user.name %></strong></span>
            <span>Order Id: <%= lesson.order.id %> </span>
            <span>Visa *****4242 </span>
          </div>
          <div class='account-amount'>
            <% if lesson.order.state == 'paid' %>
              <span>+ $<%= lesson.order.amount %></span>
            <% else %>
              <span>Pending $<%= lesson.order.amount %></span>
            <% end %>
          </div>
        </div>
        <% date = lesson.order.created_at.localtime.strftime("%d %b %Y") %>

      <% else %>
        <div class='accounts-card'>
          <div class='account-details'>
            <span><strong>Booked by: <%= lesson.order.user.name %></strong></span>
            <span>Order Id: <%= lesson.order.id %> </span>
            <span>Visa *****4242 </span>
          </div>
          <div class='account-amount'>
            <% if lesson.order.state == 'paid' %>
              <span>+ $<%= lesson.order.amount %></span>
            <% else %>
              <span>Pending $<%= lesson.order.amount %></span>
            <% end %>
          </div>
        </div>
      <%end %>
    <% end %>
    <div class='account-total-card'>
      <div class='account-total'>
      <% total = [] %>
      <% @lessons_with_orders.each do |lesson| %>
        <% if lesson.order.state == 'paid' %>
          <% total << lesson.order.amount %>
        <% end %>
      <% end %>
      <span>Total: $<%= total.sum %></span>
      </div>
    </div>
  </div>
  <%= link_to "<<", root_path, class: 'back-btn' %>
</div>
